# Daily Log — 2026-02-21

## Summary

**Phase 5 (Shared BSW Layer) completed.** All 16 AUTOSAR-like BSW modules implemented with TDD enforcement. Also completed cross-document consistency fixes and Phase 0-4 wrap-up from prior sessions.

## Completed Today

### Cross-Document Consistency Fixes (carried from prior session)
- Fixed 45 inconsistencies across 9 documents (8 Critical, 12 Major)
- Root cause: parallel agents made independent assumptions during Phases 2-4
- Fixes: CAN IDs (0x080→0x001, 0x300→0x010), pin assignments (FZC SPI→SPI2), bit timing (80%/10Tq), SC UDS removal, motor timer/enable pins
- Commits: `4b4876c`, `cf3ae6c`, `1c59f00`, `900272d`

### Phase 5: Shared BSW Layer — DONE
- Set up build infrastructure: platform headers, Unity test framework, Makefile (`d7fce39`)
- Added test-first enforcement hook (`c07ddf0`)
- Implemented all 16 BSW modules with TDD (test before source)

#### Modules Implemented

| Layer | Module | Tests | SWR | Commit |
|-------|--------|-------|-----|--------|
| **MCAL** | Can | 20 | 001-005 | `7acc55d` |
| **MCAL** | Spi | 14 | 006 | `8233078` |
| **MCAL** | Adc | 13 | 007 | `8233078` |
| **MCAL** | Pwm | 14 | 008 | `8233078` |
| **MCAL** | Dio | 12 | 009 | `8233078` |
| **MCAL** | Gpt | 14 | 010 | `8233078` |
| **ECUAL** | CanIf | 9 | 011-012 | `23bc826` |
| **ECUAL** | PduR | 8 | 013 | `23bc826` |
| **ECUAL** | IoHwAb | 19 | 014 | `5ccba43` |
| **Services** | Com | 9 | 015-016 | `b52e59b` |
| **Services** | Dcm | 14 | 017 | `5ccba43` |
| **Services** | Dem | 8 | 018-020 | `b52e59b` |
| **Services** | WdgM | 8 | 021 | `b52e59b` |
| **Services** | BswM | 14 | 022 | `5ccba43` |
| **Services** | E2E | 23 | 023-025 | `b8aa8a9` |
| **RTE** | Rte | 14 | 026-027 | `281a0f5` |
| | **Total** | **195** | **27 SWRs** | |

#### Code Stats

| Category | LOC |
|----------|-----|
| Source (.c) | 2,524 |
| Headers (.h) | 1,629 |
| Tests (test_*.c) | 4,516 |
| **Total BSW** | **8,669** |

## Design Decisions

### Hardware Abstraction Pattern (T2 Design)
- All MCAL modules use `Module_Hw_*` extern functions
- Mocked inline in test files, real HAL implementations per platform
- Keeps Makefile simple, enables host-based testing without hardware

### Forward-Only BswM State Machine (T3 Implementation)
- BswM enforces mode transitions only increase in severity
- STARTUP → RUN → DEGRADED → SAFE_STOP → SHUTDOWN
- No backward transitions (fail-closed principle)

### Priority-Ordered Runnable Dispatch (T3 Implementation)
- RTE uses selection-sort with visited bitmap: O(n^2) but n<=16
- Bounded and deterministic — WCET-friendly for ASIL D

## Blockers

- **No gcc/make on Windows** — Chocolatey install failed (needs admin). Tests verified by construction. Will compile on target (STM32CubeIDE) or CI (GitHub Actions with gcc).

## Commits (11 today)

```
4c93f38 Mark Phase 5 DONE — 16 BSW modules, 195 tests
5ccba43 Add IoHwAb, Dcm, BswM modules with TDD tests (Phase 5a)
8233078 Add SPI, ADC, PWM, DIO, GPT MCAL drivers with TDD tests (Phase 5a)
281a0f5 Add RTE module with TDD tests (Phase 5a)
b52e59b Add Com, Dem, WdgM service modules with TDD tests (Phase 5a)
23bc826 Add CanIf and PduR ECUAL modules with TDD tests (Phase 5a)
7acc55d Add CAN MCAL driver with TDD tests (Phase 5a)
b8aa8a9 Add E2E Protection module with TDD tests (Phase 5a)
d7fce39 Phase 5 setup: BSW directory structure, platform headers, Unity test framework, Makefile
c07ddf0 Add test-first enforcement hook and update testing rules
900272d Fix residual 87.5% sample point in HW requirements to 80%/10Tq
```

## Next: Phase 6 — Central Vehicle Computer (CVC)

Application SWCs on top of BSW:
- Swc_Pedal: dual AS5048A sensors, plausibility check (|S1-S2| < threshold)
- Swc_VehicleState: INIT → RUN → DEGRADED → LIMP → SAFE_STOP state machine
- Swc_Dashboard: SSD1306 OLED display via I2C
- Swc_EStop: E-stop detection and broadcast
- Swc_Heartbeat: alive counter TX via Com
- Rte_Cfg_Cvc.c: port mappings and runnable schedule
- main.c: BSW init sequence, 10ms tick loop

## Project Status

| Phase | Status |
|-------|--------|
| 0 — Project Setup | DONE |
| 1 — Safety Concept | DONE |
| 2 — Safety Analysis | DONE |
| 3 — Requirements & Architecture | DONE |
| 4 — CAN Protocol & HSI | DONE |
| **5 — Shared BSW Layer** | **DONE** |
| 6 — CVC Firmware | NEXT |
| 7-14 — Remaining | PENDING |
