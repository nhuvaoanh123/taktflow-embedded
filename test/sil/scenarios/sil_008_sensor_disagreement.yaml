# =============================================================================
# @file    sil_008_sensor_disagreement.yaml
# @brief   SIL scenario: Steering sensor fault — rapid oscillation detection
# @aspice  SWE.5 — Software Component Verification & Integration
# @iso     ISO 26262 Part 6, Section 10 — Software Integration & Testing
# @date    2026-02-24
#
# Validates the steering fault detection path.  The steer_fault scenario
# sends 10 rapid +/-40 deg oscillations that exceed the FZC's configured
# maximum steering rate, triggering a SteerFaultStatus and DTC 0xE201.
# =============================================================================

name: "Steering Sensor Fault"
id: "SIL-008"
description: >
  Inject steer_fault scenario: 10 rapid +/-40 deg oscillations at 5ms
  interval (200 deg/s effective rate).  FZC detects the rate-limit
  violation, sets SteerFaultStatus, broadcasts DTC 0xE201, and the
  vehicle transitions to DEGRADED.  Verify the complete fault detection
  and reporting chain.
verifies:
  - "SWR-FZC-002"   # FZC steering rate-limit violation detection
aspice: "SWE.5"
iso_reference: "ISO 26262 Part 6, Section 10"
timeout_sec: 20

setup:
  - action: reset
    description: "Clear residual fault state"
  - action: wait_state
    state: RUN
    timeout: 10
    description: "Ensure system is in RUN with nominal steering"

steps:
  - action: inject_scenario
    name: steer_fault
    description: >
      Send 10 rapid +/-40 deg steer command oscillations with
      rate_limit=50 deg/s (far exceeding physical capability).
      Total injection time: ~100ms.
  - action: wait
    seconds: 3
    description: "Allow FZC to detect rate-limit violation and propagate fault"

verdicts:
  - type: dtc_broadcast
    can_id: 0x500
    dtc_code: 0xE201
    ecu_source: 2
    description: "DTC 0xE201 (steer_fault) broadcast from FZC (source=2)"

  - type: vehicle_state
    expected: DEGRADED
    within_ms: 2000
    description: "Vehicle enters DEGRADED after steering fault detection"

  - type: can_message
    can_id: 0x200
    field: steer_fault_status
    expected: 1
    description: "SteerStatus (0x200) shows SteerFaultStatus = 1 (fault active)"

  - type: steering_rate_limit
    max_rate_deg_per_sec: 45
    description: "FZC must detect commands exceeding 45 deg/s steering rate"

teardown:
  - action: reset
    description: "Clear steering fault and return to idle"
  - action: wait
    seconds: 2
    description: "Allow fault state to clear"
